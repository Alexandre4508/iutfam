<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IUTFAM - Plateforme Ã‰tudiante IUT RÃ©union</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Page d'accueil -->
    <div id="landing-page" class="page active">
        <header class="landing-header">
            <div class="container">
                <img src="https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/3d7c6c29-ee4d-4964-81b0-f4659319b685.png" alt="IUTFAM Logo" class="logo-main">
                <h1>Bienvenue sur IUTFAM</h1>
                <p class="welcome-text">La plateforme qui connecte tous les Ã©tudiants de l'IUT de la RÃ©union ! ğŸŒº</p>
                
                <div class="welcome-features">
                    <div class="feature-card">
                        <h3>ğŸ—£ï¸ Chat & CommunautÃ©</h3>
                        <p>Ã‰change avec tes camarades dans le chat gÃ©nÃ©ral ou en privÃ©</p>
                    </div>
                    <div class="feature-card">
                        <h3>ğŸ‰ Ã‰vÃ©nements</h3>
                        <p>Organise et participe aux sorties Ã©tudiantes</p>
                    </div>
                    <div class="feature-card">
                        <h3>ğŸ—ºï¸ Carte Interactive</h3>
                        <p>Navigue facilement sur le campus</p>
                    </div>
                    <div class="feature-card">
                        <h3>ğŸš— Covoiturage</h3>
                        <p>Partage tes trajets avec d'autres Ã©tudiants</p>
                    </div>
                </div>

                <div class="auth-buttons">
                    <button type="button" class="btn btn--primary btn--lg" onclick="showLoginPage()">Se Connecter</button>
                    <button type="button" class="btn btn--secondary btn--lg" onclick="showRegisterPage()">S'inscrire</button>
                </div>

                <div style="margin-top: 20px;">
                    <button type="button" class="btn btn--outline" onclick="demoLogin()">ğŸ¯ Connexion dÃ©mo (Marie)</button>
                </div>
            </div>
        </header>
    </div>

    <!-- Page d'inscription -->
    <div id="register-page" class="page">
        <div class="auth-container">
            <div class="auth-card">
                <img src="https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/3d7c6c29-ee4d-4964-81b0-f4659319b685.png" alt="IUTFAM Logo" class="logo-auth">
                <h2>CrÃ©er un compte IUTFAM</h2>
                <form id="register-form" onsubmit="return register(event)">
                    <div class="form-group">
                        <label class="form-label">PrÃ©nom</label>
                        <input type="text" class="form-control" id="firstName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nom</label>
                        <input type="text" class="form-control" id="lastName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email universitaire</label>
                        <input type="email" class="form-control" id="email" placeholder="nom@iut.re ou nom@univ-reunion.fr" required>
                        <small class="form-text">Seuls les emails universitaires sont acceptÃ©s</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Mot de passe</label>
                        <input type="password" class="form-control" id="password" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">DÃ©partement</label>
                        <select class="form-control" id="department" required>
                            <option value="">Choisir un dÃ©partement</option>
                            <option value="GEA">Gestion des Entreprises et des Administrations (GEA)</option>
                            <option value="GCCD">GÃ©nie Civil Construction Durable (GCCD)</option>
                            <option value="GB">GÃ©nie Biologique (GB)</option>
                            <option value="RT">RÃ©seaux et TÃ©lÃ©communications (RT)</option>
                            <option value="CS">CarriÃ¨res Sociales (CS)</option>
                            <option value="HSE">HygiÃ¨ne SÃ©curitÃ© Environnement (HSE)</option>
                            <option value="TC">Techniques de Commercialisation (TC)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">AnnÃ©e d'Ã©tude</label>
                        <select class="form-control" id="year" required>
                            <option value="">Choisir l'annÃ©e</option>
                            <option value="1Ã¨re annÃ©e">1Ã¨re annÃ©e</option>
                            <option value="2Ã¨me annÃ©e">2Ã¨me annÃ©e</option>
                            <option value="3Ã¨me annÃ©e">3Ã¨me annÃ©e</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn--primary btn--full-width">S'inscrire</button>
                </form>
                <p class="auth-link">
                  DÃ©jÃ  inscrit ?
                  <!-- remplacÃ© par data-action -->
                  <a href="#" data-action="go-login">Se connecter</a>
                </p>
                <button type="button" class="btn btn--outline" onclick="showLandingPage()">â† Retour Ã  l'accueil</button>
            </div>
        </div>
    </div>

    <!-- Page de connexion -->
    <div id="login-page" class="page">
      <div class="auth-container">
        <div class="auth-card">
          <img src="/legacy/logo-iutfam.jpeg" alt="IUTFAM" style="max-width:160px; height:auto;" />
          <h2>Se connecter Ã  IUTFAM</h2>

          <form id="login-form" onsubmit="return login(event)">
            <div class="form-group">
              <label class="form-label" for="login-email">Email</label>
              <input type="email" class="form-control" id="login-email" required />
            </div>

            <div class="form-group">
              <label class="form-label" for="login-password">Mot de passe</label>
              <input type="password" class="form-control" id="login-password" required />
            </div>

            <button type="submit" class="btn btn--primary btn--full-width">Se connecter</button>
          </form>

          <div class="demo-credentials">
              <h4>Comptes de dÃ©monstration :</h4>
              <div class="demo-account">
                  <p><strong>Email:</strong> marie.dubois@iut.re</p>
                  <p><strong>Mot de passe:</strong> password123</p>
                  <button type="button" class="btn btn--sm btn--outline" onclick="fillDemoCredentials('marie')">Remplir automatiquement</button>
              </div>
          </div>

          <p class="auth-link">
            Pas encore inscrit ?
            <!-- remplacÃ© par data-action -->
            <a href="#" data-action="go-register">S'inscrire</a>
          </p>
          <button type="button" class="btn btn--outline" onclick="showLandingPage()">â† Retour Ã  l'accueil</button>
        </div>
      </div>
    </div>

    <!-- Application principale -->
    <div id="main-app" class="app">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-brand">
                <img src="https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/3d7c6c29-ee4d-4964-81b0-f4659319b685.png" alt="IUTFAM" class="logo-nav">
                <span>IUTFAM</span>
            </div>
            <div class="nav-menu">
                <button type="button" class="nav-link active" data-section="dashboard">ğŸ  Accueil</button>
                <button type="button" class="nav-link" data-section="chat">ğŸ’¬ Chat</button>
                <button type="button" class="nav-link" data-section="friends">ğŸ‘¥ Amis</button>
                <button type="button" class="nav-link" data-section="groups">ğŸ« Groupes</button>
                <button type="button" class="nav-link" data-section="events">ğŸ‰ Ã‰vÃ©nements</button>
                <button type="button" class="nav-link" data-section="map">ğŸ—ºï¸ Carte</button>
                <button type="button" class="nav-link" data-section="board">ğŸ“‹ Board</button>
                <button type="button" class="nav-link" data-section="canteen">ğŸ½ï¸ Cantine</button>
                <button type="button" class="nav-link" data-section="lostfound">ğŸ” Lost & Found</button>
                <button type="button" class="nav-link" data-section="transport">ğŸš— Transport</button>
            </div>
            <div class="nav-user">
                <div class="user-info">
                    <span id="currentUserName">Utilisateur</span>
                    <button type="button" class="btn btn--sm" onclick="showProfilePage()">âš™ï¸ Profil</button>
                    <button type="button" class="btn btn--sm btn--outline" onclick="logout()">DÃ©connexion</button>
                </div>
            </div>
        </nav>

        <!-- Contenu principal -->
        <main class="main-content">
            <!-- Dashboard -->
            <section id="dashboard" class="section active">
                <div class="container">
                    <h1>Tableau de bord</h1>
                    <p class="welcome-message">Bienvenue sur IUTFAM, <span id="dashboardUserName">Utilisateur</span>! ğŸŒº</p>
                    
                    <div class="dashboard-grid">
                        <div class="card">
                            <div class="card__body">
                                <h3>ğŸ’¬ Derniers messages</h3>
                                <div id="recentMessages" class="recent-messages">
                                    <div class="message-preview">
                                        <strong>Marie (GEA):</strong> Quelqu'un pour la cantine ce midi ?
                                    </div>
                                    <div class="message-preview">
                                        <strong>Thomas (RT):</strong> Super soirÃ©e hier ! ğŸ‰
                                    </div>
                                </div>
                                <button type="button" class="btn btn--primary btn--sm" onclick="showSection('chat')">Voir le chat</button>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card__body">
                                <h3>ğŸ‰ Prochains Ã©vÃ©nements</h3>
                                <div class="upcoming-events">
                                    <div class="event-preview">
                                        <strong>Repas cantine ensemble</strong><br>
                                        <small>15 septembre - Cantine IUT</small>
                                    </div>
                                    <div class="event-preview">
                                        <strong>SoirÃ©e Ã©tudiante au port</strong><br>
                                        <small>20 septembre - Port de Saint-Pierre</small>
                                    </div>
                                </div>
                                <button type="button" class="btn btn--primary btn--sm" onclick="showSection('events')">Voir tous les Ã©vÃ©nements</button>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card__body">
                                <h3>ğŸ½ï¸ Menu du jour</h3>
                                <div class="menu-preview">
                                    <strong>Aujourd'hui :</strong><br>
                                    Cari poulet, riz, rougail tomate, fruits de saison
                                </div>
                                <button type="button" class="btn btn--primary btn--sm" onclick="showSection('canteen')">Voir le menu complet</button>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card__body">
                                <h3>ğŸ‘¥ ActivitÃ©</h3>
                                <div class="activity-stats">
                                    <p><strong>127</strong> Ã©tudiants connectÃ©s</p>
                                    <p><strong>5</strong> nouveaux Ã©vÃ©nements</p>
                                    <p><strong>12</strong> messages dans votre dÃ©partement</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Chat gÃ©nÃ©ral -->
<section id="chat" class="section">
  <div class="container">
    <h1>ğŸ’¬ Chat gÃ©nÃ©ral</h1>
    <div class="chat-container">
      <div class="chat-messages" id="chatMessages">
        <!-- (tes messages dâ€™exemple peuvent rester ou Ãªtre vides) -->
      </div>

      <!-- petit indicateur de frappe -->
      <div id="typingIndicator" class="message" style="display:none; opacity:.7"></div>

      <div class="chat-input">
        <input type="text" id="messageInput" placeholder="Tapez votre message..." class="form-control">
        <button type="button" onclick="sendMessage()" class="btn btn--primary">Envoyer</button>
      </div>
    </div>
  </div>
</section>


            <!-- Amis -->
            <section id="friends" class="section">
                <div class="container">
                    <h1>ğŸ‘¥ Mes amis</h1>
                    <div class="friends-content">
                        <div class="friends-search">
                            <input type="text" placeholder="Rechercher un Ã©tudiant..." class="form-control">
                            <button type="button" class="btn btn--primary">Rechercher</button>
                        </div>
                        
                        <div class="friends-tabs">
                            <button type="button" class="btn btn--secondary active" data-tab="friends">Mes amis (3)</button>
                            <button type="button" class="btn btn--secondary" data-tab="requests">Demandes (2)</button>
                            <button type="button" class="btn btn--secondary" data-tab="search">Recherche</button>
                        </div>

                        <div id="friends-list" class="friends-list">
                            <div class="friend-card">
                                <div class="friend-info">
                                    <strong>Marie Dubois</strong>
                                    <span>GEA - 2Ã¨me annÃ©e</span>
                                </div>
                                <button type="button" class="btn btn--primary btn--sm" onclick="openPrivateChat('Marie')">ğŸ’¬ Message</button>
                            </div>
                            <div class="friend-card">
                                <div class="friend-info">
                                    <strong>Thomas Martin</strong>
                                    <span>RT - 1Ã¨re annÃ©e</span>
                                </div>
                                <button type="button" class="btn btn--primary btn--sm" onclick="openPrivateChat('Thomas')">ğŸ’¬ Message</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Groupes de classe -->
            <section id="groups" class="section">
                <div class="container">
                    <h1>ğŸ« Groupes de classe</h1>
                    <div class="groups-content">
                        <div class="group-card">
                            <div class="group-header">
                                <h3>Mon dÃ©partement - <span id="userDepartment">GEA</span></h3>
                                <div class="group-members">24 membres</div>
                            </div>
                            <div class="group-actions">
                                <button type="button" class="btn btn--primary" onclick="openGroupChat()">ğŸ’¬ Chat du groupe</button>
                                <button type="button" class="btn btn--outline" onclick="leaveGroup()">Quitter le groupe</button>
                            </div>
                        </div>

                        <div class="other-groups">
                            <h3>Autres groupes disponibles</h3>
                            <div class="group-list">
                                <div class="group-item">
                                    <span>RT - RÃ©seaux et TÃ©lÃ©communications</span>
                                    <button type="button" class="btn btn--sm btn--primary">Rejoindre</button>
                                </div>
                                <div class="group-item">
                                    <span>GB - GÃ©nie Biologique</span>
                                    <button type="button" class="btn btn--sm btn--primary">Rejoindre</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Ã‰vÃ©nements -->
            <section id="events" class="section">
                <div class="container">
                    <h1>ğŸ‰ Ã‰vÃ©nements</h1>
                    <div class="events-header">                        
                        <a class="nav-btn" href="/events">ğŸ‰ Ã‰vÃ©nements</a>

                        <button type="button" class="btn btn--primary" onclick="showCreateEvent()">+ CrÃ©er un Ã©vÃ©nement</button>
                       <a id="create-event" class="btn" href="/events/new">+ CrÃ©er un Ã©vÃ©nement</a>

                    </div>
                    
                    <div class="events-grid" id="events-list">
                        <div class="event-card">
                            <div class="event-header">
                                <h3>Repas cantine ensemble</h3>
                                <span class="event-date">15 septembre 2025</span>
                            </div>
                            <div class="event-details">
                                <p>ğŸ“ Cantine IUT</p>
                                <p>ğŸ‘¥ 5 participants</p>
                                <p>OrganisÃ© par Marie (GEA)</p>
                            </div>
                            <div class="event-actions">
                                <button type="button" class="btn btn--primary btn--sm">âœ… Participer</button>
                                <a class="btn btn--outline btn--sm" data-event="details" href="#">â„¹ï¸ DÃ©tails</a>

                            </div>
                        </div>

                        <div class="event-card">
                            <div class="event-header">
                                <h3>SoirÃ©e Ã©tudiante au port</h3>
                                <span class="event-date">20 septembre 2025</span>
                            </div>
                            <div class="event-details">
                                <p>ğŸ“ Port de Saint-Pierre</p>
                                <p>ğŸ‘¥ 12 participants</p>
                                <p>OrganisÃ© par Thomas (RT)</p>
                            </div>
                            <div class="event-actions">
                                <button type="button" class="btn btn--primary btn--sm">âœ… Participer</button>
                                <a class="btn btn--outline btn--sm" data-event="details" href="#">â„¹ï¸ DÃ©tails</a>

                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Carte -->
            <section id="map" class="section">
                <div class="container">
                    <h1>ğŸ—ºï¸ Carte du campus</h1>
                    <div class="map-container">
                        <div class="map-placeholder">
                            <h3>Carte Interactive de l'IUT</h3>
                            <p>40 avenue de Soweto, Saint-Pierre, RÃ©union</p>
                            <div class="map-points">
                                <div class="map-point">ğŸ“ BÃ¢timent Administration</div>
                                <div class="map-point">ğŸ“ AmphithÃ©Ã¢tre</div>
                                <div class="map-point">ğŸ“ Cantine</div>
                                <div class="map-point">ğŸ“ BibliothÃ¨que</div>
                                <div class="map-point">ğŸ“ Parking Ã©tudiant</div>
                                <div class="map-point">ğŸ“ Laboratoires</div>
                            </div>
                            <button type="button" class="btn btn--primary">ğŸ§­ Me localiser</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Board / Forum -->
            <section id="board" class="section">
                <div class="container">
                    <h1>ğŸ“‹ Board - Partage d'informations</h1>
                    <div class="board-header">
                        <button type="button" class="btn btn--primary" onclick="showCreatePost()">+ Nouveau post</button>
                    </div>
                    
                    <div class="board-categories">
                        <button type="button" class="btn btn--secondary active">Tout</button>
                        <button type="button" class="btn btn--secondary">ğŸ“š Ã‰tudes</button>
                        <button type="button" class="btn btn--secondary">ğŸ  Logement</button>
                        <button type="button" class="btn btn--secondary">ğŸ’¼ Emploi</button>
                        <button type="button" class="btn btn--secondary">ğŸ“ Divers</button>
                    </div>

                    <div class="posts-list">
                        <div class="post-card">
                            <div class="post-header">
                                <div class="post-author">Sarah (GB) - 2h</div>
                                <div class="post-category">ğŸ“š Ã‰tudes</div>
                            </div>
                            <h3>Recherche partenaire pour projet environnement</h3>
                            <p>Salut ! Je cherche quelqu'un pour m'accompagner sur un projet d'analyse des eaux. Contact moi si intÃ©ressÃ© !</p>
                            <div class="post-actions">
                                <button type="button" class="btn btn--outline btn--sm">ğŸ‘ 5 likes</button>
                                <button type="button" class="btn btn--outline btn--sm">ğŸ’¬ 2 commentaires</button>
                            </div>
                        </div>

                        <div class="post-card">
                            <div class="post-header">
                                <div class="post-author">Lucas (GCCD) - 5h</div>
                                <div class="post-category">ğŸ  Logement</div>
                            </div>
                            <h3>Colocation disponible prÃ¨s du campus</h3>
                            <p>Une chambre libre dans ma coloc Ã  5min de l'IUT. 350â‚¬/mois charges comprises. DM moi pour plus d'infos !</p>
                            <div class="post-actions">
                                <button type="button" class="btn btn--outline btn--sm">ğŸ‘ 8 likes</button>
                                <button type="button" class="btn btn--outline btn--sm">ğŸ’¬ 6 commentaires</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Menu Cantine -->
            <section id="canteen" class="section">
                <div class="container">
                    <h1>ğŸ½ï¸ Menu de la cantine</h1>
                    <div class="canteen-header">
                        <button type="button" class="btn btn--primary">ğŸ“¸ Poster le menu du jour</button>
                    </div>
                    
                    <div class="menu-today">
                        <div class="card">
                            <div class="card__body">
                                <h3>Menu d'aujourd'hui - 12 septembre</h3>
                                <div class="menu-content">
                                    <p><strong>Plat principal :</strong> Cari poulet</p>
                                    <p><strong>Accompagnement :</strong> Riz blanc</p>
                                    <p><strong>LÃ©gumes :</strong> Rougail tomate</p>
                                    <p><strong>Dessert :</strong> Fruits de saison</p>
                                </div>
                                <div class="menu-info">
                                    <p>ğŸ’° Prix : 3.50â‚¬ Ã©tudiants</p>
                                    <p>ğŸ• Horaires : 11h30 - 14h00</p>
                                </div>
                                <div class="menu-actions">
                                    <button type="button" class="btn btn--outline btn--sm">â­ Noter ce menu</button>
                                    <button type="button" class="btn btn--outline btn--sm">ğŸ’¬ Commentaire</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="menu-history">
                        <h3>Menus prÃ©cÃ©dents</h3>
                        <div class="menu-card">
                            <div class="menu-date">11 septembre</div>
                            <div class="menu-summary">Gratin de courgettes, salade verte, yaourt</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Lost & Found -->
            <section id="lostfound" class="section">
                <div class="container">
                    <h1>ğŸ” Lost & Found</h1>
                    <div class="lostfound-header">
                        <button type="button" class="btn btn--primary">+ DÃ©clarer un objet trouvÃ©</button>
                        <button type="button" class="btn btn--secondary">+ DÃ©clarer une perte</button>
                    </div>
                    
                    <div class="lostfound-tabs">
                        <button type="button" class="btn btn--secondary active">ğŸ” Objets trouvÃ©s</button>
                        <button type="button" class="btn btn--secondary">â“ Objets perdus</button>
                    </div>

                    <div class="lostfound-items">
                        <div class="item-card">
                            <div class="item-info">
                                <h3>ClÃ©s avec porte-clÃ© Mickey</h3>
                                <p>ğŸ“ TrouvÃ© prÃ¨s de la bibliothÃ¨que</p>
                                <p>ğŸ“… 10 septembre</p>
                                <p>ğŸ‘¤ TrouvÃ© par Marie (GEA)</p>
                            </div>
                            <div class="item-actions">
                                <button type="button" class="btn btn--primary btn--sm">ğŸ“ Contacter</button>
                            </div>
                        </div>

                        <div class="item-card">
                            <div class="item-info">
                                <h3>Sweat Ã  capuche bleu</h3>
                                <p>ğŸ“ TrouvÃ© en salle RT-05</p>
                                <p>ğŸ“… 9 septembre</p>
                                <p>ğŸ‘¤ TrouvÃ© par Thomas (RT)</p>
                            </div>
                            <div class="item-actions">
                                <button type="button" class="btn btn--primary btn--sm">ğŸ“ Contacter</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Transport / Covoiturage -->
            <section id="transport" class="section">
                <div class="container">
                    <h1>ğŸš— Transport & Covoiturage</h1>
                    <div class="transport-header">
                        <button type="button" class="btn btn--primary">+ Proposer un covoiturage</button>
                        <button type="button" class="btn btn--secondary">+ Chercher un trajet</button>
                    </div>
                    
                    <div class="transport-tabs">
                        <button type="button" class="btn btn--secondary active">ğŸš— Covoiturages</button>
                        <button type="button" class="btn btn--secondary">ğŸšŒ Transports en commun</button>
                    </div>

                    <div class="carpooling-offers">
                        <div class="carpooling-card">
                            <div class="carpooling-route">
                                <h3>Saint-Denis â†’ IUT Saint-Pierre</h3>
                                <p>ğŸ“… Lundi 15 septembre - 7h30</p>
                            </div>
                            <div class="carpooling-details">
                                <p>ğŸ‘¤ ProposÃ© par Lucas (GCCD)</p>
                                <p>ğŸ’º 2 places disponibles</p>
                                <p>ğŸ’° 5â‚¬ par personne</p>
                            </div>
                            <div class="carpooling-actions">
                                <button type="button" class="btn btn--primary btn--sm">ğŸ“ Contacter</button>
                                <button type="button" class="btn btn--outline btn--sm">â­ RÃ©server</button>
                            </div>
                        </div>

                        <div class="carpooling-card">
                            <div class="carpooling-route">
                                <h3>Le Tampon â†’ IUT Saint-Pierre</h3>
                                <p>ğŸ“… Mardi 16 septembre - 8h00</p>
                            </div>
                            <div class="carpooling-details">
                                <p>ğŸ‘¤ ProposÃ© par Sarah (GB)</p>
                                <p>ğŸ’º 1 place disponible</p>
                                <p>ğŸ’° 3â‚¬ par personne</p>
                            </div>
                            <div class="carpooling-actions">
                                <button type="button" class="btn btn--primary btn--sm">ğŸ“ Contacter</button>
                                <button type="button" class="btn btn--outline btn--sm">â­ RÃ©server</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Page profil -->
    <div id="profile-page" class="page">
        <div class="container">
            <div class="profile-container">
                <div class="profile-header">
                    <h1>âš™ï¸ Mon profil</h1>
                    <button type="button" class="btn btn--outline" onclick="backToApp()">â† Retour</button>
                </div>
                
                <div class="profile-content">
                    <div class="profile-form">
                        <div class="form-group">
                            <label class="form-label">Photo de profil</label>
                            <div class="profile-photo">
                                <div class="photo-placeholder">ğŸ“¸</div>
                                <button type="button" class="btn btn--secondary btn--sm">Changer</button>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">PrÃ©nom</label>
                            <input type="text" class="form-control" id="profileFirstName">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Nom</label>
                            <input type="text" class="form-control" id="profileLastName">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="profileEmail" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">DÃ©partement</label>
                            <select class="form-control" id="profileDepartment">
                                <option value="GEA">Gestion des Entreprises et des Administrations (GEA)</option>
                                <option value="GCCD">GÃ©nie Civil Construction Durable (GCCD)</option>
                                <option value="GB">GÃ©nie Biologique (GB)</option>
                                <option value="RT">RÃ©seaux et TÃ©lÃ©communications (RT)</option>
                                <option value="CS">CarriÃ¨res Sociales (CS)</option>
                                <option value="HSE">HygiÃ¨ne SÃ©curitÃ© Environnement (HSE)</option>
                                <option value="TC">Techniques de Commercialisation (TC)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">AnnÃ©e d'Ã©tude</label>
                            <select class="form-control" id="profileYear">
                                <option value="1Ã¨re annÃ©e">1Ã¨re annÃ©e</option>
                                <option value="2Ã¨me annÃ©e">2Ã¨me annÃ©e</option>
                                <option value="3Ã¨me annÃ©e">3Ã¨me annÃ©e</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Centres d'intÃ©rÃªt</label>
                            <textarea class="form-control" id="profileInterests" placeholder="Sport, musique, voyages..."></textarea>
                        </div>
                        
                        <div class="profile-actions">
                            <button type="button" class="btn btn--primary" onclick="saveProfile()">Sauvegarder</button>
                            <button type="button" class="btn btn--outline" onclick="backToApp()">Annuler</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="privateChat" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Chat privÃ© avec <span id="privateChatUser"></span></h3>
                <button type="button" class="modal-close" onclick="closePrivateChat()">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="chat-messages" id="privateChatMessages">
                    <div class="message">
                        <div class="message-author">Vous - 09:45</div>
                        <div class="message-content">Salut ! Comment Ã§a va ?</div>
                    </div>
                </div>
                <div class="chat-input">
                    <input type="text" id="privateMessageInput" placeholder="Tapez votre message..." class="form-control">
                    <button type="button" onclick="sendPrivateMessage()" class="btn btn--primary">Envoyer</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/legacy/app.js"></script>
    <!-- Client Socket.IO -->
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<script>
  // ====== Config locale ======
  const CHAT_ID = "GENERAL_SINGLETON"; // tu peux passer Ã  'general' si tu as crÃ©Ã© ce chat
  const USER_ID = "u_dev";             // Ã  remplacer plus tard par l'ID du user connectÃ©

  // ====== RÃ©fÃ©rences DOM ======
  const chatEl   = document.getElementById("chatMessages");
  const inputEl  = document.getElementById("messageInput");
  const typingEl = document.getElementById("typingIndicator");

  // ====== Connexion Socket.IO ======
  const socket = io(API_URL, { withCredentials: true, transports: ["websocket"] });

  socket.on("connect", () => {
    console.log("Socket.IO connectÃ©", socket.id);
    socket.emit("chat:join", { chatId: CHAT_ID, limit: 50 });
  });

  // Historique initial
  socket.on("chat:history", ({ messages }) => {
    chatEl.innerHTML = "";
    (messages || []).forEach(renderMessage);
    scrollToBottom();
  });

  // Nouveau message en temps rÃ©el
  socket.on("message:new", (m) => {
    renderMessage(m);
    scrollToBottom();
  });

// Indicateur "est en train dâ€™Ã©crire" (utilisateur rÃ©el)
socket.on("typing:update", ({ user, typing }) => {
  const name = user?.displayName || user?.username || user?.id || 'Anonyme';
  if (typing) {
    typingEl.textContent = `ğŸ’¬ ${name} est en train dâ€™Ã©crireâ€¦`;
    typingEl.style.display = "block";
  } else {
    typingEl.style.display = "none";
    typingEl.textContent = "";
  }
});


  // ====== Envoi d'un message ======
  function sendMessage() {
    const content = (inputEl.value || "").trim();
    if (!content) return;
    socket.emit("message:send", { chatId: CHAT_ID, content, senderId: USER_ID });
    inputEl.value = "";
    socket.emit("typing:stop", { chatId: CHAT_ID, userId: USER_ID });
  }
  window.sendMessage = sendMessage; // nÃ©cessaire car appelÃ© via onclick= dans le HTML

  // Enter pour envoyer + typing indicators
  inputEl.addEventListener("keydown", (e) => {
    if (e.key === "Enter") sendMessage();
  });
 inputEl.addEventListener("input", (e) => {
  if ((e.target.value || "").trim().length > 0) {
    socket.emit("typing:start", { chatId: CHAT_ID });
  } else {
    socket.emit("typing:stop", { chatId: CHAT_ID });
  }
});


  // ====== Helpers ======
  function renderMessage(m) {
    const wrap  = document.createElement("div");
    wrap.className = "message";

    const author = document.createElement("div");
    author.className = "message-author";
    const name = m.sender?.username || m.sender?.email || m.senderId || "Anonyme";
    const time = new Date(m.createdAt).toLocaleTimeString();
    author.textContent = `${name} - ${time}`;

    const body = document.createElement("div");
    body.className = "message-content";
    body.textContent = m.content;

    wrap.appendChild(author);
    wrap.appendChild(body);
    chatEl.appendChild(wrap);
  }

  function scrollToBottom() {
    chatEl.scrollTop = chatEl.scrollHeight;
  }
</script>
<script>
(async () => {
  const API = "http://localhost:4000";

  function formatCreator(ev) {
    const u = ev.createdBy || {};
    const name = u.displayName || u.username || "Anonyme";

    const cg = u.classGroup || {};
    // On essaie dâ€™avoir quelque chose du style "GEA1" ou "GEA"
    const formation =
      cg.department ||
      cg.code ||
      (cg.name ? cg.name : "");

    return formation ? `${name} (${formation})` : name;
  }

  try {
    const res = await fetch(`${API}/events`, { cache: "no-store" });
    if (!res.ok) {
      console.warn("Erreur HTTP sur /events :", res.status);
      return;
    }

    const events = await res.json();
    const container = document.getElementById("events-list");
    if (!container) return;

    if (!Array.isArray(events) || events.length === 0) {
      container.innerHTML = `
        <p class="menu-preview">Aucun Ã©vÃ©nement pour le moment. CrÃ©e le premier ! ğŸ‰</p>
      `;
      return;
    }

    const html = events.map(ev => {
      const date = ev.startsAt
        ? new Date(ev.startsAt).toLocaleDateString("fr-FR", {
            day: "2-digit",
            month: "long",
            year: "numeric"
          })
        : "Date inconnue";

      const organiser = formatCreator(ev);

      return `
        <div class="event-card">
          <div class="event-header">
            <h3>${ev.title || "Ã‰vÃ©nement"}</h3>
            <span class="event-date">${date}</span>
          </div>

          <div class="event-details">
            <p>ğŸ“ ${ev.location || "Lieu inconnu"}</p>
            <p>ğŸ‘¥ Nouvel Ã©vÃ©nement</p>
            <p>OrganisÃ© par ${organiser}</p>
          </div>

          <div class="event-actions">
            <button type="button" class="btn btn--primary btn--sm" disabled>
              âœ… Participer
            </button>
            <a class="btn btn--outline btn--sm" href="/events/${ev.id}">
              â„¹ï¸ DÃ©tails
            </a>
          </div>
        </div>
      `;
    }).join("");

    container.innerHTML = html;
  } catch (err) {
    console.warn("Erreur lors du chargement des Ã©vÃ©nements :", err);
  }
})();
</script>


</body>
</html>
